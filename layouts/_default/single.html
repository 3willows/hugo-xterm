{{- define "main" -}}
<article class="post">
  <header class="post-header">
    {{- if .Title }}
    <h1 class="post-title"><a href="{{ .Permalink }}">{{ .Title | markdownify }}</a></h1>
    {{- end }}

    {{- if or (.Params.Date) (.Params.Author) }}
    <address class="post-meta">
      {{- with .Params.Date }}
      <time pubdate datetime="{{ .Format "2006-01-02 15:04:05 IST" }}">
      Published on {{ .Format "2006-01-02 15:04:05 IST" }}
      </time>
      {{- end }}
      
      {{- with .Params.Author }}
      by {{ . }}
      {{- end }}
      
      {{- with .Params.LastMod }}
      <time pubdate datetime="{{ .Format "2006-01-02 15:04:05 IST" }}">
      last modified {{ .Format "2006-01-02 15:04:05 IST" }}.
      </time>
      {{- end }}
    </address>
    {{- end }}

    {{- if .Params.tags }}
    <p class="post-tags">Tags:&nbsp; {{- range .Params.tags -}}#<a href="{{ (urlize (printf "tags/%s/" .)) | absLangURL }}">{{ . }}</a>&nbsp;{{- end -}}</p>
    {{- end }}

    {{- with .Params.Description }}
    <p class="post-meta">{{ . }}</p>
    {{- end }}
  </header>

  {{- if .Params.Cover }}
  <img src="{{ .Params.Cover | absURL }}" class="post-cover"
    {{ with .Params.CoverAlt }} alt="{{ . | plainify }}" {{ end }} />
  {{- end }}

  {{- if and (.Param "toc") (ne .TableOfContents "<nav id=\"TableOfContents\"></nav>") }}
  <div class="post-toc">
    <h2>{{ "Table of Contents" | markdownify }}</h2>
    {{ .TableOfContents }}
  </div>
  {{- end }}

  {{- with .Content }}
  <div class="post-content">
    {{ . | replaceRE "(<h[1-9] id=\"([^\"]+)\".+)(</h[1-9]+>)" `${1}<a href="#${2}" class="hanchor" ariaLabel="Anchor">&#8983;</a> ${3}` | safeHTML }}
  </div>
  {{- end }}

  {{- if eq .Type "posts" }}
  <footer class="post-footer">
    {{- if templates.Exists "partials/support-me.html" -}}
      {{- partial "support-me.html" . -}}
    {{- end -}}
    {{- partial "posts_pagination.html" . -}}
    {{- partial "comments.html" . -}}
  </footer>
  {{- end }}
</article>
{{- end -}}
